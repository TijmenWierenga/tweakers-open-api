version: '3.7'

services:
  api:
    image: php:8-alpine
    ports:
    - 80:80
    volumes:
    - .:/app
    - sqlite:/database
    working_dir: /app
    command: ash -c "php -f migrate.php && php -S 0.0.0.0:80 -t public"

  mock:
    image: stoplight/prism:latest
    ports:
    - 3100:3100
    volumes:
    - ./reference/demo-api.v1.yaml:/reference/demo-api.v1.yaml
    command: mock -h 0.0.0.0 -p 3100 /reference/demo-api.v1.yaml

  docs:
    image: redocly/redoc:latest
    ports:
    - 8080:80
    volumes:
    - ./reference/:/usr/share/nginx/html/spec/
    environment:
    - SPEC_URL=spec/demo-api.v1.yaml

volumes:
  sqlite:
